<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>THEOPHILEMAKER E-LEARNING</title>
<style>
:root{
  --bg:#0f1724;
  --card:#0b1220;
  --accent:#7c3aed;
  --muted:#94a3b8;
  --glass: rgba(255,255,255,0.04);
  --radius:14px;
  --hover-glow: rgba(124,58,237,0.4);
  color-scheme: dark;
  font-family: Arial, Helvetica, sans-serif;
}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,#071028 0%, #0b1230 100%);color:#e6eef8}
header{display:flex;align-items:center;justify-content:space-between;padding:18px 28px;flex-wrap:wrap}
.brand{display:flex;gap:14px;align-items:center}
.logo{width:64px;height:64px;border-radius:12px;overflow:hidden;background:linear-gradient(90deg,var(--accent),#4f46e5);display:flex;align-items:center;justify-content:center;cursor:pointer}
.logo img{width:100%;height:100%;object-fit:cover}
.title{font-weight:800;font-size:18px}
nav{display:flex;gap:8px;flex-wrap:wrap}
.btn{background:var(--glass);border:1px solid rgba(255,255,255,0.04);padding:8px 12px;border-radius:10px;color:white;cursor:pointer;text-decoration:none;transition:0.3s}
.btn:hover{background:rgba(124,58,237,0.2);}
.btn.primary{background:linear-gradient(90deg,var(--accent),#4f46e5);border:none}
.container{max-width:1200px;margin:26px auto;padding:0 18px}
.hero{display:grid;grid-template-columns:1fr 420px;gap:22px}
.hero-card{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:22px;border-radius:var(--radius)}
.small{font-size:13px;color:var(--muted)}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:18px;margin-top:14px;justify-content:center}
.card{background:var(--card);padding:18px;border-radius:12px;text-align:center;transition:0.3s;cursor:pointer;}
.card:hover{transform:translateY(-5px);box-shadow:0 0 15px var(--hover-glow);}
.footer{margin-top:40px;padding:24px;text-align:center;color:var(--muted);font-size:13px}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.7)}
.modal.show{display:flex}
.dialog{background:#071124;padding:18px;border-radius:12px;width:95%;max-width:700px}
.subject{
  background:#0b1220;
  padding:12px;
  border-radius:12px;
  margin:8px;
  text-align:center;
  width:200px;
  transition:0.3s;
}
.subject:hover{transform:translateY(-5px);box-shadow:0 0 12px var(--hover-glow);}
.subject h4{margin:0 0 8px 0}
.link-btn{
  display:inline-block;
  margin-top:6px;
  margin-right:6px;
  padding:6px 10px;
  background:#1f2937;
  border-radius:8px;
  font-size:12px;
  cursor:pointer;
  text-decoration:none;
}
.item-img{
  width:100%;
  height:140px;
  background:#111827;
  border-radius:10px;
  margin-bottom:8px;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition:0.3s;
}
.item-img:hover{transform:scale(1.05);box-shadow:0 0 12px var(--hover-glow);}
.item-img img{width:100%;height:100%;object-fit:cover}

/* Responsive */
@media(max-width:900px){
  .hero{grid-template-columns:1fr;}
  .hero-card{margin-bottom:20px;}
  .grid{grid-template-columns:repeat(auto-fill,minmax(180px,1fr));}
  .subject{width:90%;}
}
</style>
</head>
<body>

<header>
  <div class="brand">
    <div class="logo" id="logoDrop">
      <img id="logoImg">
      <span id="logoText" style="display:none;font-weight:bold">TM</span>
    </div>
    <div>
      <div class="title">THEOPHILEMAKER E-Learning</div>
      <div class="small">Learn more, Create, Share your possession</div>
    </div>
  </div>

  <nav>
    <button class="btn" id="adminBtn">Admin Login</button>
    <a class="btn" href="#courseTypes">Online Courses</a>
    <a class="btn" href="#servicesGrid">Our Services</a>
    <a class="btn" href="#productsGrid">Our Products</a>
    <a class="btn" href="#securitySection">Security</a>
    <a class="btn primary" href="mailto:theophilen298@gmail.com">Contact</a>
  </nav>
</header>

<main class="container">

<section class="hero">
  <div class="hero-card">
    <h1>Welcome, THEOPHILEMAKER</h1>
    <p class="small">Upload sessions, manage lessons and share knowledge.</p>

    <div style="margin-top:12px">
      <input id="globalSearch" placeholder="Search..." style="padding:10px;width:70%">
      <button class="btn" id="createSessionBtn">New Session</button>
    </div>

    <div id="sessionsList" class="grid">
      <div class="small">No sessions found. Add one!</div>
    </div>
  </div>

  <aside>
    <div class="hero-card">
      <h3>Quick Access</h3>
      <div class="small">Admin can upload sessions and manage content.</div>
      <div style="margin-top:10px">theophilen298@gmail.com</div>
      <div style="margin-top:10px">
        <button class="btn" id="replaceLogoBtn">Replace Logo</button>
        <button class="btn" id="downloadDataBtn">Download Data</button>
      </div>
    </div>
  </aside>
</section>

<section class="hero-card" style="margin-top:18px">
  <h2>Our Services</h2>
  <div class="grid" id="servicesGrid"></div>
</section>

<section class="hero-card" style="margin-top:18px">
  <h2>Our Products</h2>
  <div class="grid" id="productsGrid"></div>
</section>

<section class="hero-card" style="margin-top:18px">
  <h2>Online Courses</h2>
  <div id="courseTypes" style="display:flex;flex-wrap:wrap;justify-content:center;"></div>
</section>

<section id="securitySection" class="hero-card" style="margin-top:18px">
  <h2>Security & Trust</h2>
  <div class="small">
    Most welcome. Your data is secured and protected.
    Take what you want in the shortest time possible.
  </div>
</section>

<!-- Session Modal (with file & video upload) -->
<div id="sessionModal" class="modal">
  <div class="dialog">
    <h3>New Session</h3>
    <input id="sessTitle" placeholder="Title"><br><br>
    <textarea id="sessDesc" placeholder="Description"></textarea><br><br>
    <select id="sessCourseType">
      <option value="">--Select Course Type--</option>
    </select><br><br>
    <label class="small">Upload File (PDF, DOC, etc.)</label><br>
    <input type="file" id="sessFile" accept=".pdf,.doc,.docx,.txt"><br><br>
    <label class="small">Upload Video</label><br>
    <input type="file" id="sessVideo" accept="video/*"><br><br>
    <button class="btn primary" id="saveSessionBtn">Save</button>
    <button class="btn" id="cancelSessionBtn">Cancel</button>
  </div>
</div>

<div class="footer">
Built for THEOPHILEMAKER â€¢ theophilen298@gmail.com
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, doc, setDoc, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-storage.js";

// ================== FIREBASE CONFIG ==================
const firebaseConfig = {
  apiKey: "AIzaSyC4C2uWND_pfmPmz5Yr5SZ2hGNTH_MahXs",
  authDomain: "theophilemaker.firebaseapp.com",
  projectId: "theophilemaker",
  storageBucket: "theophilemaker.firebasestorage.app",
  messagingSenderId: "877489083781",
  appId: "1:877489083781:web:8d2baa4d9a15c23b33a0ec"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

// ================== CONSTANTS ==================
const ADMIN_PASSWORD = 'theo@123';
let isAdmin = false;
let sessions = [], courses = {}, products = [], services = [];

// Default items from your old file
const defaultCourses = {
  "Programming": ["Python", "HTML", "JavaScript", "Java", "Visual Basic", "C++", "CSS"],
  "Database": ["MySQL", "SQL Server"],
  "Data Science": ["Statistics", "Mathematics", "Probability"]
};
const defaultProducts = ['Telephone Batteries','Electrical Chargers','Computer Accessories','Keyboards & Mouse','Flash Disks'];
const defaultServices = ['Software Installation','Software Development','Computer Maintenance','System Analysis & Design'];

// ================== FIREBASE HELPERS ==================
async function loadCollection(name){
  const snap = await getDocs(collection(db,name));
  return snap.docs.map(d => d.data());
}
async function saveDoc(col,id,data){
  await setDoc(doc(db,col,id), {...data, timestamp: serverTimestamp()});
}
async function uploadFile(file,path){
  const fileRef = ref(storage,path);
  await uploadBytes(fileRef,file);
  return await getDownloadURL(fileRef);
}

// ================== INITIAL LOAD ==================
async function loadData(){
  // Load sessions
  sessions = await loadCollection('sessions');

  // Load courses
  const courseDocs = await loadCollection('courses');
  courses = {};
  if(courseDocs.length === 0){
    // Prepopulate default courses
    for(const t in defaultCourses){
      courses[t] = [];
      defaultCourses[t].forEach((name,i)=>{
        const c = {id: t+'_'+i, name, file:'', video:''};
        courses[t].push(c);
        saveDoc('courses', c.id, {...c,type:t});
      });
    }
  } else {
    courseDocs.forEach(c=>{ 
      if(!courses[c.type]) courses[c.type]=[];
      courses[c.type].push(c);
    });
  }

  // Load products
  const productDocs = await loadCollection('products');
  if(productDocs.length===0){
    products = defaultProducts.map((name,i)=>({id:'p'+i,name,img:''}));
    products.forEach(p => saveDoc('products',p.id,p));
  } else products = productDocs;

  // Load services
  const serviceDocs = await loadCollection('services');
  if(serviceDocs.length===0){
    services = defaultServices.map((name,i)=>({id:'s'+i,name,img:''}));
    services.forEach(s => saveDoc('services',s.id,s));
  } else services = serviceDocs;

  renderAll();
}
loadData();

// ================== DOM SELECTORS ==================
const $ = s => document.querySelector(s);
const sessionsList = $('#sessionsList');
const sessionModal = $('#sessionModal');
const sessCourseType = $('#sessCourseType');
const fileInput = $('#sessFile');
const videoInput = $('#sessVideo');

// ================== UTILS ==================
function uid(){return 'id_'+Math.random().toString(36).slice(2,9);}

// ================== RENDER FUNCTIONS ==================
function renderSessions(filter=''){
  sessionsList.innerHTML='';
  const q = filter.toLowerCase();
  const out = sessions.filter(s => s.title.toLowerCase().includes(q) || s.desc.toLowerCase().includes(q));
  if(out.length===0){sessionsList.innerHTML='<div class="small">No sessions found.</div>'; return;}
  out.forEach(s=>{
    const d = document.createElement('div'); d.className='card';
    d.innerHTML=`<h3>${s.title}</h3><div class="small">${s.desc}</div>
      ${s.file?`<a class="link-btn" href="${s.file}" download>Download File</a>`:''}
      ${s.video?`<video src="${s.video}" controls style="width:100%;margin-top:6px"></video>`:''}`;
    sessionsList.appendChild(d);
  });
}

function renderCourses(){
  const box = $('#courseTypes'); box.innerHTML='';
  for(const t in courses){
    const wrap = document.createElement('div');
    wrap.style.display='flex'; wrap.style.flexWrap='wrap'; wrap.style.justifyContent='center'; wrap.style.margin='12px';
    wrap.innerHTML=`<h3 style="width:100%;text-align:center;margin-bottom:12px">${t}</h3>`;
    courses[t].forEach(sub=>{
      const div = document.createElement('div'); div.className='subject';
      div.innerHTML=`<h4>${sub.name}</h4>
        ${sub.file?`<a class="link-btn" href="${sub.file}" download>Download File</a>`:''}
        ${sub.video?`<video src="${sub.video}" controls style="width:180px;margin-top:6px"></video>`:''}`;
      wrap.appendChild(div);
    });
    box.appendChild(wrap);
  }
}

function renderProducts(){
  const box = $('#productsGrid'); box.innerHTML='';
  products.forEach(p=>{
    const d = document.createElement('div'); d.className='card';
    d.innerHTML=`<div class="item-img" ${isAdmin?`onclick="uploadProductImage('${p.id}')"`:''}>
      ${p.img?`<img src="${p.img}">`:'<span class="small">No image</span>'}
      </div><h3>${p.name}</h3>`;
    box.appendChild(d);
  });
}

function renderServices(){
  const box = $('#servicesGrid'); box.innerHTML='';
  services.forEach(s=>{
    const d = document.createElement('div'); d.className='card';
    d.innerHTML=`<div class="item-img" ${isAdmin?`onclick="uploadServiceImage('${s.id}')"`:''}>
      ${s.img?`<img src="${s.img}">`:'<span class="small">No image</span>'}
      </div><h3>${s.name}</h3>`;
    box.appendChild(d);
  });
}

function renderAll(){
  renderSessions(); renderCourses(); renderProducts(); renderServices();
  populateCourseTypes();
}

// ================== ADMIN ==================
$('#adminBtn').addEventListener('click',()=>{
  const p = prompt('Enter admin password');
  if(p===ADMIN_PASSWORD){
    isAdmin = true;
    $('#adminBtn').textContent='Admin (ON)';
    $('#adminBtn').style.background='#16a34a';
    renderAll();
  } else alert('Wrong password');
});

// ================== COURSE-TYPE SELECT ==================
function populateCourseTypes(){
  sessCourseType.innerHTML = '<option value="">--Select Course Type--</option>';
  for(const t in courses){
    const opt = document.createElement('option'); opt.value=t; opt.textContent=t;
    sessCourseType.appendChild(opt);
  }
}

// ================== SAVE SESSION ==================
$('#saveSessionBtn').addEventListener('click', async ()=>{
  const t = $('#sessTitle').value.trim();
  const d = $('#sessDesc').value.trim();
  const cType = sessCourseType.value;
  if(!t || !cType){alert('Title and course type required'); return;}
  
  const session = {id: uid(), title:t, desc:d, course:cType, file:'', video:''};

  if(fileInput.files[0]) session.file = await uploadFile(fileInput.files[0], `files/${session.id}_${fileInput.files[0].name}`);
  if(videoInput.files[0]) session.video = await uploadFile(videoInput.files[0], `videos/${session.id}_${videoInput.files[0].name}`);

  // Save to Firestore
  await saveDoc('sessions', session.id, session);
  if(!courses[cType]) courses[cType] = [];
  courses[cType].push(session);
  await saveDoc('courses', session.id, {...session, type:cType});

  sessions.push(session);
  renderAll();
  sessionModal.classList.remove('show');

  $('#sessTitle').value=''; $('#sessDesc').value=''; sessCourseType.value=''; fileInput.value=''; videoInput.value='';
});

// ================== UPLOAD IMAGES ==================
async function uploadProductImage(id){
  if(!isAdmin){alert('Admin only'); return;}
  const f = document.createElement('input'); f.type='file'; f.accept='image/*';
  f.onchange = async ()=>{
    const imgUrl = await uploadFile(f.files[0], `products/${id}_${f.files[0].name}`);
    const p = products.find(x=>x.id===id); p.img=imgUrl;
    await saveDoc('products',id,p);
    renderProducts();
  }; f.click();
}
async function uploadServiceImage(id){
  if(!isAdmin){alert('Admin only'); return;}
  const f = document.createElement('input'); f.type='file'; f.accept='image/*';
  f.onchange = async ()=>{
    const s = services.find(x=>x.id===id);
    s.img = await uploadFile(f.files[0], `services/${id}_${f.files[0].name}`);
    await saveDoc('services',id,s);
    renderServices();
  }; f.click();
}

// ================== SEARCH ==================
$('#globalSearch').addEventListener('input', e=> renderSessions(e.target.value));

// ================== CREATE SESSION ==================
$('#createSessionBtn').addEventListener('click', ()=>{if(!isAdmin){alert('Admin only'); return;} sessionModal.classList.add('show');});
$('#cancelSessionBtn').onclick = ()=>sessionModal.classList.remove('show');
</script>

</body>
</html>
